<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Voice Assistant with Custom Voice Cloning</title>
  <!-- Updated <style> tag in your <head> -->
<style>
  @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600&family=Inter:wght@400;600&display=swap');

  :root {
    --bg-dark: #020b16;
    --bg-card: rgba(7, 20, 35, 0.6);
    --accent: #55f0f4;
    --accent-hover: #33e6ec;
    --text-main: #ffffff;
    --text-muted: #a0aaba;
    --btn-color: #0affc2;
    --font-hero: 'Rajdhani', sans-serif;
    --font-body: 'Inter', sans-serif;
  }

  body {
    background: linear-gradient(135deg, #020b16, #071423);
    color: var(--text-main);
    font-family: var(--font-body);
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }

  .container {
    max-width: 1400px;
    margin: auto;
    padding: 60px 20px;
    position: relative;
    z-index: 1;
  }

  header {
    text-align: center;
    padding: 60px 0 40px;
    background: linear-gradient(180deg, rgba(2,11,22,1) 0%, rgba(7,20,35,1) 100%);
    position: relative;
    border-radius: 20px;
    margin-bottom: 40px;
  }

  header::after {
    content: "";
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    background-image: url('data:image/svg+xml;utf8,<svg width="800" height="200" xmlns="http://www.w3.org/2000/svg"><path d="M 0 100 Q 200 0 400 100 T 800 100" stroke="%2333e6ec" fill="none" opacity="0.03"/></svg>');
    background-repeat: no-repeat;
    background-size: cover;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
  }

  h1 {
    font-family: var(--font-hero);
    font-size: 2.5rem;
    font-weight: 600;
    letter-spacing: 2px;
    color: var(--accent);
    z-index: 2;
    position: relative;
    text-shadow: 0 0 10px rgba(85, 240, 244, 0.3);
    animation: glow 2s ease-in-out infinite alternate;
  }
  

  @keyframes glow {
    from {
      text-shadow: 0 0 8px var(--accent);
    }
    to {
      text-shadow: 0 0 20px var(--accent-hover);
    }
  }

  .subtitle {
    font-size: 1.2rem;
    color: var(--text-muted);
    margin-top: 10px;
    font-weight: 400;
    position: relative;
    z-index: 2;
  }

  /* Updated column layout container - Changed ratio to 70/30 */
  .columns-container {
    display: grid;
    grid-template-columns: 1fr 0.5fr;
    gap: 30px;
    align-items: start;
  }

  .card {
    background: var(--bg-card);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-radius: 20px;
    padding: 25px;
    margin-top: 0; /* Remove margin since we're using grid gap */
    box-shadow: 0 8px 24px rgba(85, 240, 244, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
    height: fit-content;
  }

  .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(85, 240, 244, 0.2);
  }

  .card-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 20px;
  }

  .form-group label {
    color: var(--text-muted);
    font-weight: 500;
    display: block;
    margin-bottom: 6px;
  }

  input[type="text"],
  input[type="file"],
  select,
  textarea {
    background-color: #0d1b2a;
    color: var(--text-main);
    border: 1px solid #1a2c42;
    border-radius: 10px;
    padding: 12px;
    width: 100%;
    margin-bottom: 20px;
    font-size: 1rem;
    transition: 0.3s ease;
    box-sizing: border-box;
  }

  input:focus,
  select:focus,
  textarea:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(85, 240, 244, 0.2);
  }

  .btn {
    background: linear-gradient(145deg, var(--btn-color), var(--accent-hover));
    color: #000;
    font-weight: 600;
    padding: 12px 24px;
    border: none;
    border-radius: 999px;
    cursor: pointer;
    transition: 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 0 rgba(85, 240, 244, 0.4);
  }

  .btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 12px var(--accent-hover);
  }

  .btn:active {
    transform: scale(0.97);
  }

  .btn-stop {
    background: #ff3366;
    color: #fff;
  }

  .btn-stop:hover {
    background: #ff0055;
  }

  .btn-group {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-top: 20px;
  }

  .response-area {
    background-color: #0e1f2f;
    padding: 15px;
    border-left: 4px solid var(--accent);
    border-radius: 12px;
    margin-top: 20px;
    font-size: 0.9rem;
    box-shadow: 0 0 8px rgba(85, 240, 244, 0.08);
  }

  audio {
    width: 100%;
    margin-top: 15px;
    border-radius: 8px;
  }

  .status {
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 15px;
    display: none;
    font-size: 0.95rem;
  }

  .status.active {
    display: block;
    background-color: rgba(85, 240, 244, 0.1);
    border-left: 4px solid var(--accent);
  }

  .status.error {
    display: block;
    background-color: rgba(255, 51, 102, 0.1);
    border-left: 4px solid #ff3366;
  }

  .upload-area {
    border: 2px dashed rgba(85, 240, 244, 0.2);
    border-radius: 12px;
    padding: 24px;
    text-align: center;
    transition: 0.3s ease;
    cursor: pointer;
    background-color: rgba(13, 27, 42, 0.3);
  }

  .upload-area:hover {
    border-color: var(--accent);
    background-color: rgba(85, 240, 244, 0.05);
  }

  .upload-label input[type="file"] {
    display: none;
  }

  /* Enhanced responsive design for columns */
  @media (max-width: 1024px) {
    .columns-container {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .container {
      padding: 40px 15px;
    }
    
    h1 {
      font-size: 2.2rem;
    }
  }

  @media (max-width: 768px) {
    h1 {
      font-size: 1.9rem;
    }
    .btn-group {
      flex-direction: column;
    }
    
    .columns-container {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .card {
      padding: 20px;
    }
    
    header {
      padding: 40px 0 30px;
    }
  }

  @media (max-width: 480px) {
    h1 {
      font-size: 1.6rem;
    }
    
    .subtitle {
      font-size: 1rem;
    }
    
    .card-title {
      font-size: 1.3rem;
    }
  }

  * {
    transition: all 0.25s ease-in-out;
  }

  /* Audio Controls Styling */
  .audio-controls {
    background: linear-gradient(145deg, #0d1b2a, #1a2c42);
    border: 1px solid var(--accent);
    border-radius: 15px;
    padding: 20px;
    margin-top: 15px;
    box-shadow: 0 4px 12px rgba(85, 240, 244, 0.2);
  }

  .audio-control-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    font-weight: 600;
    color: var(--accent);
    font-size: 1.1rem;
  }

  .audio-icon {
    font-size: 1.2rem;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  .audio-buttons {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
  }

  .audio-btn {
    background: linear-gradient(145deg, var(--accent), var(--accent-hover));
    color: #000;
    border: none;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1.2rem;
    box-shadow: 0 2px 8px rgba(85, 240, 244, 0.3);
  }

  .audio-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(85, 240, 244, 0.5);
  }

  .audio-btn:active {
    transform: scale(0.95);
  }

  .audio-btn.stop {
    background: linear-gradient(145deg, #ff3366, #ff1744);
    color: #fff;
  }

  .audio-btn.stop:hover {
    box-shadow: 0 4px 12px rgba(255, 51, 102, 0.5);
  }

  .volume-control {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-left: auto;
  }

  .volume-icon {
    font-size: 1.1rem;
    color: var(--text-muted);
  }

  .volume-slider {
    width: 80px;
    height: 4px;
    background: #1a2c42;
    border-radius: 2px;
    outline: none;
  }

  .volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    background: var(--accent);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(85, 240, 244, 0.3);
  }

  .volume-slider::-moz-range-thumb {
    width: 16px;
    height: 16px;
    background: var(--accent);
    border-radius: 50%;
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 4px rgba(85, 240, 244, 0.3);
  }

  @media (max-width: 768px) {
    .audio-buttons {
      justify-content: center;
    }
    
    .volume-control {
      margin-left: 0;
      margin-top: 10px;
    }
  }

  /* Additional enhancements for professional look */
  .voice-selector {
    margin-bottom: 20px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  /* Improved chat history styling */
  #chatHistory {
    max-height: 200px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--accent) transparent;
  }

  #chatHistory::-webkit-scrollbar {
    width: 6px;
  }

  #chatHistory::-webkit-scrollbar-track {
    background: transparent;
  }

  #chatHistory::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 3px;
  }

  /* Enhanced button styling for better UX */
  .btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
  }

  .btn:disabled:hover {
    transform: none !important;
    box-shadow: none !important;
  }
</style>
</head>
<body>
  <a href="/logout" class="btn" style="margin-top:20px;">Logout</a>
  <div class="container">
    <header>
      <h1>AI Voice Assistant</h1>
      <p class="subtitle">Advanced voice cloning with Claude AI integration</p>
    </header>
    
    <!-- New columns container -->
    <div class="columns-container">
      <!-- Left Column - Voice Assistant (now wider) -->
      <div class="card">
        <h2 class="card-title">🎙 Voice Assistant</h2>
        
        <div class="voice-selector">
          <label for="voiceChoice">Your voices:</label>
          <select id="voiceChoice" class="form-control">
            <option value="default">Default (Alexa-style)</option>
            {% for rec in recordings %}
              <option value="{{ rec }}">{{ rec.replace('.wav', '') }}</option>
            {% endfor %}
          </select>
        </div>
        
        <div class="btn-group">
          <button id="askBtn" class="btn">Ask</button>
        </div>

        
        <div id="status" class="status"></div>
        
        <div class="response-area">
          <p id="transcript"><strong>User :</strong> <em>Press Start Recording to begin...</em></p>
          <div id="chatHistory" style="margin-top: 20px;">
            <strong>Previous Conversation:</strong><br><br>
            {% for pair in history %}
              <div style="margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                <p style="margin: 0;"><strong>You:</strong> {{ pair.user }}</p>
                <p style="margin: 0;"><strong>Claude:</strong> {{ pair.bot }}</p>
              </div>
            {% endfor %}
            {% if not history %}
              <p style="color: var(--text-muted);">No previous conversation yet.</p>
            {% endif %}
          </div>

          <p id="response"><strong>Claude's Response:</strong> <em>Waiting for your input...</em></p>

          <audio id="responseAudio" controls style="display: none;"></audio>
        </div>
      </div>
      
      <!-- Right Column - Voice Cloning Studio (now narrower) -->
      <div class="card">
        <h2 class="card-title">🧬 Voice Cloning Studio</h2>
        
        <form method="POST" enctype="multipart/form-data">
          <div class="upload-area">
            <label for="recording" class="upload-label">
              <strong>Choose a WAV file</strong> or drag and drop here
              <input type="file" name="recording" id="recording" accept=".wav" required>
            </label>
          </div>
          
          <div class="form-group">
            <label for="rec_name">Voice Name:</label>
            <input type="text" name="rec_name" id="rec_name" placeholder="e.g. 'john' or 'sarah'" required>
          </div>
          
          <button type="submit" class="btn">Upload Voice Sample</button>
          
          {% if message %}
            <div class="status {% if 'Error' in message %}error{% else %}active{% endif %}" style="display: block;">
              {{ message }}
            </div>
          {% endif %}
        </form>
        
        <!-- Audio Control Panel -->
        <div id="audioControls" class="audio-controls" style="display: none;">
          <div class="audio-control-header">
            <span class="audio-icon">🔊</span>
            <span>Audio Playback</span>
          </div>
          <div class="audio-buttons">
            <button id="playPauseBtn" class="audio-btn play-pause">
              <span id="playPauseIcon">⏸️</span>
            </button>
            <button id="stopAudioBtn" class="audio-btn stop">
              <span>⏹️</span>
            </button>
            <div class="volume-control">
              <span class="volume-icon">🔉</span>
              <input type="range" id="volumeSlider" min="0" max="100" value="100" class="volume-slider">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = 'en-US';

    const askBtn = document.getElementById('askBtn');
    const statusDiv = document.getElementById('status');

    recognition.onstart = () => {
      askBtn.disabled = true;
      statusDiv.textContent = "Listening... Speak now";
      statusDiv.className = "status active";
      document.getElementById("transcript").innerHTML = "<strong>Transcript:</strong> <em>Listening...</em>";
    };

    recognition.onend = () => {
      askBtn.disabled = false;
      statusDiv.textContent = "Ready for new question";
      statusDiv.className = "status active";
    };

    recognition.onresult = async (event) => {
      const transcript = event.results[0][0].transcript;
      document.getElementById("transcript").innerHTML = `<strong>Transcript:</strong> ${transcript}`;
      document.getElementById("response").innerHTML = "<strong>Claude's Response:</strong> <em>Processing...</em>";

      try {
        const voiceChoice = document.getElementById("voiceChoice").value;
        statusDiv.textContent = "Processing with Claude AI...";

        const response = await fetch("/process", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ 
            user_input: transcript,
            voice_choice: voiceChoice
          })
        });

        const data = await response.json();

        if (data.error) throw new Error(data.error);

        document.getElementById("response").innerHTML = `<strong>Claude's Response:</strong> ${data.response}`;
        statusDiv.textContent = "Response ready!";

        if (data.voice_generated) {
          const audio = document.getElementById("responseAudio");
          const audioControls = document.getElementById("audioControls");
          audio.src = "/play?" + new Date().getTime();
          audio.style.display = "block";
          audioControls.style.display = "block";
          audio.play();
          
          // Update play/pause button when audio starts
          document.getElementById("playPauseIcon").textContent = "⏸️";
        } else {
          speakOutLoud(data.response);
        }
      } catch (err) {
        console.error("Error:", err);
        document.getElementById("response").innerHTML = `<strong>Claude's Response:</strong> <em>Error: ${err.message}</em>`;
        statusDiv.textContent = `Error: ${err.message}`;
        statusDiv.className = "status error";
      }
    };

    recognition.onerror = (e) => {
      console.error("Speech recognition error:", e.error);
      statusDiv.textContent = `Error: ${e.error}`;
      statusDiv.className = "status error";
      askBtn.disabled = false;
    };

    function speakOutLoud(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      speechSynthesis.speak(utterance);
    }

    askBtn.addEventListener('click', () => {
      recognition.start();
    });

    // Audio Control Functions
    const audio = document.getElementById("responseAudio");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const stopAudioBtn = document.getElementById("stopAudioBtn");
    const volumeSlider = document.getElementById("volumeSlider");
    const playPauseIcon = document.getElementById("playPauseIcon");
    const audioControls = document.getElementById("audioControls");

    // Play/Pause functionality
    playPauseBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
        playPauseIcon.textContent = "⏸️";
      } else {
        audio.pause();
        playPauseIcon.textContent = "▶️";
      }
    });

    // Stop functionality
    stopAudioBtn.addEventListener('click', () => {
      audio.pause();
      audio.currentTime = 0;
      playPauseIcon.textContent = "▶️";
      audioControls.style.display = "none";
      audio.style.display = "none";
    });

    // Volume control
    volumeSlider.addEventListener('input', (e) => {
      audio.volume = e.target.value / 100;
    });

    // Audio event listeners
    audio.addEventListener('ended', () => {
      playPauseIcon.textContent = "▶️";
      audioControls.style.display = "none";
    });

    audio.addEventListener('pause', () => {
      playPauseIcon.textContent = "▶️";
    });

    audio.addEventListener('play', () => {
      playPauseIcon.textContent = "⏸️";
    });

    // Drag and drop file upload (unchanged)
    const uploadArea = document.querySelector('.upload-area');
    const fileInput = document.getElementById('recording');

    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = 'var(--accent)';
      uploadArea.style.backgroundColor = 'rgba(72, 149, 239, 0.1)';
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.style.borderColor = '#ddd';
      uploadArea.style.backgroundColor = '';
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = '#ddd';
      uploadArea.style.backgroundColor = '';

      if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        document.querySelector('.upload-label').innerHTML = `<strong>File selected:</strong> ${e.dataTransfer.files[0].name}`;
      }
    });

    fileInput.addEventListener('change', () => {
      if (fileInput.files.length) {
        document.querySelector('.upload-label').innerHTML = `<strong>File selected:</strong> ${fileInput.files[0].name}`;
      }
    });
</script>

</body>
</html>